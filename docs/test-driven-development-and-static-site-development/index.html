<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'sha256-40CawJrzluNf1nxeAkOG02xSE4t1QeakZEwxqUotM6Q='; style-src 'self'; img-src 'self'; connect-src 'self' https://plausible.io/api/event; manifest-src 'self';">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/assets/css/main.css" rel="stylesheet" />

        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">

        
        
        
            <meta name="description" content="As a software engineer, I always find ways to streamline my workflow while maintaining a high-quality output. Recently, I’ve been working on several static projects using Eleventy, and I found a way to incorporate Test-Driven Development (TDD) into my process. This blog post is about my journey and how it resulted in a more efficient, robust, and enjoyable development experience.">
            <meta property="og:description" content="As a software engineer, I always find ways to streamline my workflow while maintaining a high-quality output. Recently, I’ve been working on several static projects using Eleventy, and I found a way to incorporate Test-Driven Development (TDD) into my process. This blog post is about my journey and how it resulted in a more efficient, robust, and enjoyable development experience.">
            <meta name="description" content="As a software engineer, I always find ways to streamline my workflow while maintaining a high-quality output. Recently, I’ve been working on several static projects using Eleventy, and I found a way to incorporate Test-Driven Development (TDD) into my process. This blog post is about my journey and how it resulted in a more efficient, robust, and enjoyable development experience."/>
        

        
        
            <meta property="og:image" content="/assets/images/tdd-static-sites-social.jpg"/>
            <meta name="twitter:image" content="/assets/images/tdd-static-sites-social.jpg"/>
        

        <title>
            
                Test-Driven Development and Static Site Development | Nizar&#39;s Blog
            
        </title>

        <meta property="og:site_name" content="Nizar's Blog">
        <meta property="og:type" content="website">
        <script defer data-domain="nizar.se" src="https://plausible.io/js/script.js" integrity="sha256-40CawJrzluNf1nxeAkOG02xSE4t1QeakZEwxqUotM6Q=" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="layout-wrapper">
            <header class="header">
    <div class="header__content">
        <h1 class="site-title">
            <a href="/">Nizar's Blog</a>
        </h1>
        <nav class="nav">
            <ul class="nav__list">
                <li class="nav-item">
                    <a href="/about">About</a>
                </li>
            </ul>
        </nav>
    </div>
</header>
            <main class="main">
                <article class="post">
    <header class="post__header">
        <h1>Test-Driven Development and Static Site Development</h1>
        <div class="post__details">
            <time>30 Jun 2023</time>
            <span> | </span>
            <span>4 minutes</span>
        </div>
    </header>

    <div class="post__cover">
        <picture><source type="image/avif" srcset="/test-driven-development-and-static-site-development/QRqKOILzfb-300.avif 300w, /test-driven-development-and-static-site-development/QRqKOILzfb-600.avif 600w, /test-driven-development-and-static-site-development/QRqKOILzfb-750.avif 750w, /test-driven-development-and-static-site-development/QRqKOILzfb-900.avif 900w, /test-driven-development-and-static-site-development/QRqKOILzfb-1200.avif 1200w, /test-driven-development-and-static-site-development/QRqKOILzfb-1400.avif 1400w" sizes="Cover image"><source type="image/jpeg" srcset="/test-driven-development-and-static-site-development/QRqKOILzfb-300.jpeg 300w, /test-driven-development-and-static-site-development/QRqKOILzfb-600.jpeg 600w, /test-driven-development-and-static-site-development/QRqKOILzfb-750.jpeg 750w, /test-driven-development-and-static-site-development/QRqKOILzfb-900.jpeg 900w, /test-driven-development-and-static-site-development/QRqKOILzfb-1200.jpeg 1200w, /test-driven-development-and-static-site-development/QRqKOILzfb-1400.jpeg 1400w" sizes="Cover image"><img alt="Cover image" loading="lazy" decoding="async" src="/test-driven-development-and-static-site-development/QRqKOILzfb-300.jpeg" width="1400" height="933"></picture>
        <p class="post__cover-caption">Photo by <a href="https://unsplash.com/@edhoradic">Edho Pratama</a> on <a href="https://unsplash.com/photos/T6fDN60bMWY">Unsplash</a></p>
    </div>

    <main class="post__content">
        <p>As a software engineer, I always find ways to streamline my workflow while maintaining a high-quality output. Recently, I’ve been working on several static projects using Eleventy, and I found a way to incorporate Test-Driven Development (TDD) into my process. This blog post is about my journey and how it resulted in a more efficient, robust, and enjoyable development experience.</p>
<h2>Setup</h2>
<p>I use Eleventy, a simpler static site generator, combined with Jest for testing and Cheerio for DOM manipulation. With this setup, I created three vital pieces of functionality: configuring Eleventy programmatically, rendering layouts in a test environment, and leveraging formatted frontmatter.</p>
<h2>Configuring Eleventy for Dynamic Testing</h2>
<p>To enable testing in a manner identical to the production environment, we create Eleventy configurations dynamically. This way, configuration parameters such as paths can be adjusted when rendering layouts for tests.</p>
<p>The following code block shows how we achieve this. The solution is quite simple and allows us to do everything a straight-forward configuration file allows us and more. We can easily add any plugins or functionality we want and can also extend it with additional parameters for anything that we would like to dynamically control. Do note that we need to take care of any relative paths so that they can continue to resolve correctly.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> pluginBookshop <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@bookshop/eleventy-bookshop'</span><span class="token punctuation">)</span><br><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> buildConfig <span class="token operator">=</span> <span class="token punctuation">(</span>eleventyConfig<span class="token punctuation">,</span> bookshopLocation <span class="token operator">=</span> <span class="token string">'component-library'</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  eleventyConfig<span class="token punctuation">.</span><span class="token function">addPlugin</span><span class="token punctuation">(</span><br>    <span class="token function">pluginBookshop</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      <span class="token literal-property property">bookshopLocations</span><span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> bookshopLocation<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> eleventyConfig<br><span class="token punctuation">}</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> buildConfig</code></pre>
<p>With the functionality in place, we can simply replace the contents of our <code>.eleventy.js</code> configuration file with the following line.</p>
<pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config-builder'</span><span class="token punctuation">)</span></code></pre>
<p>We also need to move our <code>.eleventy.js</code> file from the root of the project directory to a different location. This is because Eleventy, by default, reads any configuration file it finds in the root directory, and as a consequence, overrides any programmatic configurations we make. This is however not an issue as we can simply point it to our new file location in the package. json script as shown in the following code snippet.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"eleventy --serve --config=config/.eleventy.js --input=site"</span><br><span class="token punctuation">}</span></code></pre>
<h2>Rendering Layouts in a Test Environment</h2>
<p>The second step in our setup involves rendering a layout specified by name with provided front matter data. To do this, we need to create a temporary directory as Eleventy, at the time of this writing, doesn’t support the processing of templates without them being part of a file. We then run an eleventy instance from within our Node script and have it return the rendered output.</p>
<p>Another limitation that we have to work around is that Eleventy does not natively support an <code>_includes</code> directory that is outside the input directory. We do this by creating symbolic links to any files or directories that we need to render our layouts.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createSymlinks</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">tmpDir</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> directories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'_includes'</span><span class="token punctuation">,</span> <span class="token string">'assets'</span><span class="token punctuation">]</span><br>  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><br>    directories<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>      <span class="token function">symlink</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'site'</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>tmpDir<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<p>We now have everything we need to create our rendering functionality. The following code block shows how we combine what we have created so far and create our test layout, render it and return the result.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// create a unique temporary directory</span><br>  <span class="token keyword">const</span> tmpDir <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">mkdtemp</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">tmpdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span>sep<span class="token punctuation">)</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token comment">// write the data to index.liquid in the temp directory</span><br>    <span class="token keyword">const</span> inputPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>tmpDir<span class="token punctuation">,</span> <span class="token string">'index.liquid'</span><span class="token punctuation">)</span><br>    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>inputPath<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><br><br>    <span class="token comment">// create symbolic links</span><br>    <span class="token keyword">await</span> <span class="token function">createSymlinks</span><span class="token punctuation">(</span>tmpDir<span class="token punctuation">)</span><br><br>    <span class="token comment">// Instantiate Eleventy with configuration</span><br>    <span class="token keyword">const</span> elev <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Eleventy</span><span class="token punctuation">(</span>tmpDir<span class="token punctuation">,</span> tmpDir<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">quiet</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">config</span><span class="token operator">:</span> buildConfig<span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>    <span class="token comment">// Return the content</span><br>    <span class="token keyword">const</span> jsonOutput <span class="token operator">=</span> <span class="token keyword">await</span> elev<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">return</span> jsonOutput<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Couldn't render template: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><br>    <span class="token keyword">throw</span> e<br>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span><br>    <span class="token comment">// clean up the temporary directory</span><br>    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">rm</span><span class="token punctuation">(</span>tmpDir<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">force</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> render</code></pre>
<h2>Leveraging Formatted Frontmatter</h2>
<p>Finally, we build a function that formats frontmatter according to a specified template. Any unpassed properties are not created, offering increased flexibility for our tests. It also reduces potential clutter and ensures that our tests remain concise and readable.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">generateFrontmatter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">blockName<span class="token punctuation">,</span> values</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> block <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- _bookshop_name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>blockName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><br><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      block <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>values<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> outdent<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>    ---<br>    permalink: /<br>    content_blocks:<br>      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>block<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>    ---</span><span class="token template-punctuation string">`</span></span><br><span class="token punctuation">}</span></code></pre>
<p>In the above function, the first parameter specifies the block we want to use while the second parameter is an object whose keys represent field names and the values represent their respective values. We can now use it as shown below.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> frontmatter <span class="token operator">=</span> <span class="token function">generateFrontmatter</span><span class="token punctuation">(</span><span class="token string">'hero'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> body <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h2>Putting It All Together</h2>
<p>As you can see, the result is quite beautiful, if I may say so myself. It tests the real project files in an environment identical to production. As a result, I can ensure that the test results accurately represent the final user experience. What’s more, this setup is efficient and runs significantly faster than when using tools like Cypress.</p>
<pre class="language-js"><code class="language-js"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Hero'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token string">'Hero Title'</span><br>  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token string">'Hero body'</span><br>  <span class="token keyword">let</span> frontmatter<span class="token punctuation">,</span> page<span class="token punctuation">,</span> $<br><br>  <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    frontmatter <span class="token operator">=</span> <span class="token function">generateFrontmatter</span><span class="token punctuation">(</span><span class="token string">'hero'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> body <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    page <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">render</span><span class="token punctuation">(</span>frontmatter<span class="token punctuation">)</span><br>    $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'has the correct title'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> heroTitle <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.c-hero_title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token function">expect</span><span class="token punctuation">(</span>heroTitle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'has the correct body'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> heroBody <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.c-hero_body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token function">expect</span><span class="token punctuation">(</span>heroBody<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>That is not to say that there is no place for other test tools. In fact, I feel that I get the most value when I combine multiple tools and leverage their combined strengths.</p>
<p>So, that’s my approach. By sharing it, I hope to encourage you to explore the potential of TDD in your own static site projects if you don’t already use it. The setup may seem daunting at first, but the long-term benefits are certainly worth it.</p>

    </main>

    <aside class="post__aside">
        <div class="post__tags">
            
            
                
                <a href="/tags/tdd/">#tdd</a>
            
                
                <a href="/tags/static-sites/">#static-sites</a>
            
        </div>
    </aside>
</article>

            </main>

            <footer class="footer">
    <div class="footer__content">
        <p class="footer__attribution">Powered by <a href="https://www.11ty.dev">11ty</a>, based on <a href="https://github.com/yinkakun/eleventy-duo">Eleventy Duo</a></p>
    </div>
</footer>
        </div>
    </body>
</html>